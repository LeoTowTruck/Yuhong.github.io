<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="高雄屏東道路救援 | 24小時專業拖吊車服務 | 一通電話GPS定位快速到達 | 汽車故障拖吊 | 誠信、安全、高效">
  <meta name="keywords" content="高雄拖吊車, 屏東拖吊車, 高雄道路救援, 屏東道路救援, 24小時拖吊服務">
  <meta property="og:type" content="website">
  <meta property="og:title" content="高雄屏東道路救援 | 24小時專業拖吊車服務">
  <meta property="og:description" content="一通電話GPS定位快速到達，提供高效誠信的汽車故障拖吊服務。">
  <meta property="og:image" content="https://lh3.googleusercontent.com/pw/AP1GczMm2FiYFOMNkgOhg1BQXQ6sCINqbQBMkFa4Jd8LzQWtAI-rAFoYY-lXlvdOirwwhCh2sWmFgWodeU8homqs07lnOMxDCTdk0TIpWiaVLW12wL_8-kXGCv1UuqfGmVwfIpQPegxqzkgnsPIiv_5tN-LZ=w1200-h630-s-no-gm?authuser=0">
  <meta property="og:url" content="https://leotowtruck.github.io/Yuhong.github.io">
  <meta property="og:site_name" content="高雄屏東道路救援 拾捌拖吊車">
  <meta property="og:locale" content="zh_TW">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="高雄屏東道路救援 | 24小時專業拖吊車服務">
  <meta name="twitter:description" content="一通電話GPS定位快速到達，提供高效誠信的汽車故障拖吊服務。">
  <meta name="twitter:image" content="https://lh3.googleusercontent.com/pw/AP1GczM06pX2zDPg3j8thWQ4dcku7lKPy1tV7C6UGYtllPoF5Rhrbcb9Yhzr9noIBvXc0l8H3CYArwtEAnya0X_F-lRx_W6ngHZkHJSsIq5Q29QeR-MVMVXq5Zlsj6i5W3C2b-jHryfWY_7LF4PS9QqtHGjL=w1481-h833-s-no-gm?authuser=0">
  <link rel="icon" href="https://lh3.googleusercontent.com/pw/AP1GczMmpgeIJhvbzNK8dr50D-NplG92CU1-ufAnga61ovELszXWWft-HFBLu5XFFVM_IDlyKAvJ4vz7EMqqAARmb0HrzTpfovK3z2Kdl2976ITBv3u1dgiyMQglpozlIbIJ03Vb8arKr28kuqVLk1y7i38-=w720-h720-s-no-gm?authuser=0" type="image/png">
  <link rel="canonical" href="https://leotowtruck.github.io/Yuhong.github.io">
  <title>高雄屏東道路救援 | 一通電話GPS定位快速到達 | 24小時專業拖吊車服務 | 汽車故障拖吊 | 誠信、安全、高效</title>

  <!-- 結構化數據 -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",  <!-- 定義使用的語意網上下文 -->
    "@type": "Organization",           <!-- 定義數據的類型為「組織」 -->
    "name": "拾捌拖吊車",                <!-- 組織的名稱 -->
    "url": "https://leotowtruck.github.io/Yuhong.github.io",  <!-- 組織的官方網站URL -->
    "logo": "https://lh3.googleusercontent.com/pw/AP1GczNCCLnBr72_G8BGYYL77W1fj5ZtG4FI27oHDsumjBxtfNfsz0G9Ghkn6THxkyb7qUUBBKAiovCmviNBclhD4StXeUNocjrsMHq6d3HcD-pO13scIlQIFAdW6yETZcKsT56ZDnGaUnsJodUox-QJ4xsN=w64-h64-s-no-gm?authuser=0",              <!-- 組織的標誌URL   -->
    "contactPoint": {                    <!-- 聯繫點的詳細信息 -->
      "@type": "ContactPoint",           <!-- 聯繫點的類型    -->
      "telephone": "+886-981-263-978",   <!-- 聯繫電話號碼    -->
      "contactType": "Customer Service", <!-- 聯繫點的類型（如客戶服務） -->
      "description": "24H道路救援拖吊車"   <!-- 聯繫點的描述    -->
    },
    "address": {                         <!-- 組織的地址信息      -->
      "@type": "PostalAddress",          <!-- 定義這是一個郵寄地址 -->
      "addressLocality": "屏東市",        <!-- 城市名稱           -->
      "addressRegion": "屏東縣",          <!-- 縣（地區）名稱      -->
      "addressCountry": "TW"             <!-- 國家代碼（台灣）     -->
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": 22.531971599999995,
      "longitude": 120.45756160000003
    }
  }

</script>

<!-- 引入 Google Fonts CSS、SVG -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&family=Noto+Serif+HK:wght@200..900&display=swap" rel="stylesheet">

<!-- 引入 Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> 

<!-- google map api -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjSGiVQD0Hl5nYWlpgnuQggcaixwv4DFw&libraries=places"></script>

<style>
  /* Reset CSS */
  * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
  }

  html {
      scroll-padding-top: 65px; /* 設置距離頁面頂部的距離 */
      scroll-behavior: smooth; /* 启用平滑滚动 */
  }

  html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      overflow-x: hidden; /* 隱藏水平滾動條 */
      touch-action: manipulation; /* 禁止雙擊縮放 */
  }

  body {
      background-color: #1e1e1e; /* 設置背景顏色*/
      font-family: 'Montserrat', sans-serif;
      padding-top: 80px;
      padding-bottom: 100px;
  }

  .container-fluid {
      width: 100%;
      max-width: 1200px;
      padding: 0 5%;
      transition: padding 0.5s ease; /* 過渡效果 */
  }

  .Sr {
      position: absolute;
      clip: rect(0, 0, 0, 0);         /* 兼容舊版瀏覽器      */
      clip: rect(1px, 1px, 1px, 1px); /* 這行是為了確保兼容性 */
      overflow: hidden;
      width: 1px;                     /* 必須要有寬度和高度   */
      height: 1px;                    /* 必須要有寬度和高度   */
  }

/********************************************************************************************/

  /* -- 頭部 -- */
  .navbar {
      font-size: 18px;
      font-weight: 700; /* 粗體字重 */
      width: 100%;
      padding: 5px 10px;
      transition: transform 0.5s ease; /* 添加平滑過渡效果 */
      position: fixed; /* 固定在頂部 */
      top: 0;
      left: 0;
      right: 0;
      z-index: 1; /* 確保導航欄在頂層 */
  }

  .navbar.hidden {
      transform: translateY(-100%); /* 隱藏導航欄 */
  }

  .noto-serif-hk-logo {
      font-family: "Noto Serif HK", serif;
      font-weight: 900; /* 使用最粗字重 */
      font-style: normal;
      letter-spacing: 0.1em; /* 增加字母間距 */
      font-size: 1.3em; /* 調整字體大小 */
      color: #EAC100; /* 設置顏色，可根據需要調整 */
      text-shadow: 2px 2px 4px rgba(150, 150, 150, 0.5); /* 灰色陰影 */
      text-decoration: none;
  }

  .navbar .d-flex .logo img {
      width: 50px;
      border-radius: 50%; /* 使圖片成為圓形 */
  }

  .nav-item {
      padding: 5px 0 5px 20px;
  }


/********************************************************************************************/

  .uploadBox {
    min-width: 30vw;
    width: 100%;
    height: 22vh;
    border: 3px dashed #ccc;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 3px;
    margin: 10px 0;
    background: #3e3e3e;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* 陰影效果 */
  }

  .uploadBox label {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #5e5e5e;
  }

  .uploadBox img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none; /* 初始時隱藏圖片 */
  }

  .uploadBox input {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
  }

  .delPhotoBtn {
    position: absolute;
    top: 0px;
    right: 0px;
    border: none;
    color: #767A7F;
    border-radius: 50%;
    font-size: 2em; 
    width: 35px;
    height: 35px;
    cursor: pointer;
    background: rgba(62,62,62, 0.9);
  }

  .delPhotoBtn:hover {
    background: rgb(65, 65, 65);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* 鼠標懸停陰影 */
  }

/********************************************************************************************/

  .formBlock {
      height: auto;
      border-radius: 15px;
      padding: 20px;
      background-color: #2e2e2e;
      border: 1px solid #444;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* 添加陰影 */
      margin: 10px 0 10px 0;
  }

  .formBlock h2 {
      text-align: center; /* 文字置中 */
      color: #FFDC35; /* 標題顏色 */
      font-size: 1.75em;
      margin: 10px 0 10px 0;
  }  
  
  .formInput {
      width: 100%;
      height: 50px;
      color: #fff;
      font-size: 1em;
      background-color: #3e3e3e; /* 輕微的背景色 */
      border: 1px solid #444; /* 邊框顏色 */
      border-radius: 5px; /* 圓角邊框 */
      padding: 10px;
      margin-top: 30px;
      outline: none; /* 取消聚焦框線 */
  }

  .formInput:focus {
      border-color: #FFDC35; /* 聚焦時邊框顏色 */
      background-color: #333; /* 聚焦時背景色 */
  }

  .formInput::placeholder {
      color: #ccc; /* 占位符顏色 */
      opacity: 1; /* 確保占位符不透明 */
  }

  #goGps {
    padding-right: 36px;
  }

  .error {
      color: red;
      font-size: 0.9em;
      margin-left: 5px;
  }

  .input-container {
      position: relative;
  }

  #mapPrevious, #submitPrevious {
      position: absolute;
      top: -6px;
      left: -10px; 
      width: 45px;
      height: 45px;
      border: none; 
      background: transparent; 
      font-size: 2em; 
      color: #767A7F;
      border-radius: 50%;
      display: flex; /* 使用 Flexbox 來居中內容 */
      align-items: center;
      justify-content: center;
      z-index: 0;
  }

  #mapPrevious:hover, #submitPrevious:hover {
      background: rgb(60, 60, 60);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 鼠標懸停陰影 */
  }

  .moveLabel {
      width: 90%;
      position: absolute;
      top: 45px;
      left: 12px;
      color: #ccc;
      pointer-events: none;
      transition: all 0.3s ease;
      white-space: nowrap;     /* 防止文字換行     */
      overflow: hidden;        /* 隱藏超出範圍的內容 */
      text-overflow: ellipsis; /* 超出部分顯示省略號 */
  }

  .formInput:focus + .moveLabel,
  .formInput:not(:placeholder-shown) + .moveLabel {
      width: 100%;
      top: 12px;
      left: 4px;
      font-size: 0.75em;
      color: #FFDC35;
  }

    /* 為 textarea 元素設置單獨的高度規則 */
    textarea.formInput {
        height: auto; /* 取消固定高度，允許 rows 屬性生效 */
    }

/********************************************************************************/

  .formButton, #confirmButton {
      color: #1e1e1e; /* 文字顏色 */
      font-size: 1.2em; /* 字體大小 */
      font-weight: 900; /* 粗體字重 */
      width: 100%;
      height: 50px;
      background-color: #FFDC35;
      color: #1e1e1e;
      border: none;
      border-radius: 5px;
      font-size: 1em;
      margin-top: 24px;
      transition: all 0.3s;
  }

  .formButton:hover, #confirmButton:hover {
      background-color: #f5c300;
  }

  #myGpsBtn, #goGpsBtn {
      width: 50px;   
      height: 50px;
      border-radius: 5px; 
      padding: 5px;
      margin: 30px 12px 0 0;
      background-color: #3e3e3e; /* 輕微的背景色 */
      border: 1px solid #444; /* 邊框顏色 */
      transition: all 0.3s ease; /* 添加過渡效果 */
  }

  #myGpsBtn img, #goGpsBtn img {
      width: 100%; /* 確保圖片不超出按鈕 */
      height: 100%; /* 確保圖片不超出按鈕 */
      object-fit: cover; /* 保持圖片比例，填滿按鈕 */
      animation: shake 5s infinite; /* 應用動畫 */
  }

  #myGpsBtn:hover, #goGpsBtn:hover {
      background-color: #4e4e4e; /* 輕微的背景色 */
  }

  /* 定義輕微晃動的動畫 */
  @keyframes shake {
      0% { transform: translateX(0) rotate(0deg); }
      15% { transform: translateX(-2px) rotate(-7deg); }
      30% { transform: translateX(2px) rotate(7deg); }
      45% { transform: translateX(-2px) rotate(-7deg); }
      100% { transform: translateX(0) rotate(0deg); }
  }

/********************************************************************************/

  .map-content {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      opacity: 0;         /*  隱藏  */
      visibility: hidden; /*  隱藏  */
      display: none;      /*  隱藏  */
      z-index: 2;
  }

  .map-content.fullscreen {
      opacity: 1;          /*  顯示  */
      visibility: visible; /*  顯示  */
      display: block;      /*  顯示  */
  }

  #map {
      width: 100%;
      height: 100vh;
      transition: opacity 0.5s, visibility 0.5s; /* 使顯示和隱藏過渡平滑 */
      z-index: 2;
  }

  #mapShow {
      margin: 18px 0 6px 0;
      width: 100%;
      height: 40vh;
      transition: all 0.3s;
  }
  
  /* 左上角的XY座標 */
  #showMapXY {
      position: fixed;
      top: -1px;   /* 距離底部 */
      left: 0px;  /* 距離右邊 */
      width: 100%;
      font-size: 0.75em;
      color: #fff;
      background-color: rgba(17, 17, 17, 0.5); /* 30% 不透明度的背景顏色 */
      border: none;
      padding-left: 10px;
      z-index: 3; /* 確保控制項在地圖上方 */
  }

  /* 搜尋容器 */
  .search-container {
      width: 80%; /* 確保搜尋框留出足夠的空間 */
      position: fixed; /* 固定位置 */
      left: 50%;
      top: 30px;             
      transform: translateX(-50%); /* 水平置中 */
      z-index: 4;
  }

  /* 搜索框 */
  #searchInput {
      width: 100%; /* 確保搜尋框留出足夠的空間 */
      border-radius: 50px; /* 設置足夠大的圓角半徑以實現圓形效果 */
      padding: 10px 105px 10px 20px;
      border: none; 
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
      position: relative; /* 相對定位 */
      outline: none; /* 移除焦點框 */
  }

  /* 刪除搜索文字 */
  #searchBtn, #delSearchTxtBtn, #delGoGpsInputBtn  {
      position: absolute;
      top: 50%;
      right: 10px; 
      width: 45px;
      height: 45px;
      transform: translateY(-50%); 
      border: none; 
      background: transparent; 
      font-size: 2em; 
      color: #767A7F;
      border-radius: 50%;
      display: flex; /* 使用 Flexbox 來居中內容 */
      align-items: center;
      justify-content: center;
      z-index: 5;
  }

  #delGoGpsInputBtn {
      top: 69%;
      right: 1px; 
      z-index: 0;
  }

  #searchBtn {
      right: 60px; 
  }

  #searchBtn:hover, #delSearchTxtBtn:hover {
      background: #F0F0F0;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 鼠標懸停陰影 */
  }
  #delGoGpsInputBtn:hover {
      background: rgb(70, 70, 70);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 鼠標懸停陰影 */
  }


  /* 重新定位按鈕 */
  #shareLocation {
      position: fixed;
      right: 10px;  /* 距離右邊 */
      bottom: 80px; /* 距離底部 */
      width: 70px;  /* 按鈕寬度 */
      height: 70px; /* 按鈕高度 */
      color: #767A7F;
      font-size: 2em; 
      border: 2px solid #ffffff; /* 白色邊框 */
      border-radius: 50%; /* 使按鈕圓形 */
      background-color: #F0F0F0; /* 背景顏色 */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* 添加陰影 */
      z-index: 3; /* 確保控制項在地圖上方 */
      transition: background-color 0.3s, box-shadow 0.3s; /* 添加過渡效果 */
  }
  
  /* 鼠標懸停時的效果 */
  #shareLocation:hover {
      background-color: #E0E0E0; /* 鼠標懸停背景顏色 */
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4); /* 鼠標懸停陰影 */
  }

  /* 確認定位按鈕 */
  #checkGpsOkBtn {
      width: 200px;
      height: 60px;
      background-color: #FFDC35; 
      border: none; 
      border-radius: 10px; 
      color: #1e1e1e; 
      font-size: 1.2em; 
      font-weight: 900;
      transition: background-color 0.3s;        /* 背景顏色過渡效果 */
      position: fixed;                          /* 固定位置 */
      left: 50%;
      bottom: 25px;             
      transform: translateX(-50%);              /* 水平置中 */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* 添加陰影 */
      z-index: 4; 
      opacity: 1; /* 默認可見 */
      visibility: visible; /* 默認可見 */
  }

  /* 鼠標懸停時的效果 */
  #checkGpsOkBtn:hover {
      background-color: #f5c300; /* 鼠標懸停背景顏色 */
  }

  /* 隱藏狀態的樣式 */
  #checkGpsOkBtn.hidden {
      opacity: 0;
      visibility: hidden;
  }


  #checkGpsOkBtn:disabled {
      opacity: 0.3; /* 設置透明度 */
      cursor: not-allowed; /* 更改游標樣式 */
  }

  button:disabled {
      opacity: 0.3; /* 設置透明度 */
      cursor: not-allowed; /* 更改游標樣式 */
  }

/********************************************************************************/

  /* 警告視窗的樣式 */
  .alert-box {
      display: flex; /* 使用 Flexbox 來居中內容 */
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0; /* 修改為 0，讓它佔據整個視窗 */
      left: 0; /* 修改為 0，讓它佔據整個視窗 */
      width: 100%;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.7);
      opacity: 0; /* 初始隱藏，透明度設為 0 */
      visibility: hidden; /* 初始隱藏，隱藏狀態 */
      transition: opacity 0.3s ease, visibility 0.3s ease; /* 添加過渡效果 */
      z-index: 9998;
  }

  .alert-box.show {
      opacity: 1; /* 顯示時透明度設為 1 */
      visibility: visible; /* 顯示時可見 */
  }

  .alert-content {
      width: 70%;
      max-width: 500px; /* 可選：限制最大寬度 */
      height: auto;
      text-align: center;
      background-color: #2e2e2e;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      z-index: 9999;
  }

  .alert-box p {
      font-size: 1.1em;
      color: #fff;
      white-space: pre-line; /* 處理換行符號 */
      margin: 0 0 10px;
      
  }


/*********************************************************************/


  /* 將container設置為一個flex容器，內容居中 */
  .containerLoader {
      position: fixed;
      top: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.7); /* 設置背景色為50%透明度的黑色 */
      z-index: 9997; /* 確保容器在最上層 */ 
      width: 100%;
      height: 100vh;
  }

  .central {
      height: 100%;
      display: flex; /* 使用 Flexbox 來居中內容 */
      align-items: center;
      justify-content: center;
  }

  /* 設置loading效果的基本樣式 */
  .loader {
      width: 80px; /* 設置loader的寬度 */
      height: 80px; /* 設置loader的高度 */
      border: 10px solid rgba(255, 255, 255, 0.2); /* 設置透明的邊框，顏色為白色的20%透明度 */
      border-top: 10px solid #3498db; /* 設置頂部邊框為藍色，創造旋轉效果 */
      border-right: 10px solid #3498db; /* 設置右側邊框為藍色 */
      border-bottom: 10px solid #3498db; /* 設置底部邊框為藍色 */
      border-radius: 50%; /* 將邊框設置為圓形 */
      animation: spin 1s linear infinite; /* 添加旋轉動畫，持續時間為1秒，線性重複無限次 */
      box-shadow: 0 0 20px #3498db; /* 添加陰影效果，顏色為藍色 */
  }

  /* 定義旋轉動畫 */
  @keyframes spin {
      0% {
          transform: rotate(0deg); /* 初始狀態，不旋轉 */
      }
      100% {
          transform: rotate(360deg); /* 完成一圈旋轉 */
      }
  }


/*********************************************************************/   


  /*  右下電話 & Line  */
  .fixed-buttons-container {
      position: fixed;
      bottom: 30px;           /* 距離底部的距離 */
      right: 20px;            /* 距離右邊的距離 */
      display: flex;
      flex-direction: column; /* 垂直排列按鈕   */
      gap: 10px;              /* 按鈕間距      */
      z-index: 999;
  }
  
  .call-button, .Line-button {
      width: 55px;
      height: 55px;
      box-shadow: 2px 5px 5px rgba(0, 0, 0, 0.3); /* 僅在底部添加陰影效果 */
      border-radius: 10px;
      border: none; /* 移除邊框 */
      padding: 10px 10px;
      animation: shake_call 5s infinite; /* 添加動畫 */
  }

  .call-button .icon, .Line-button .icon {
      width: 100%;
      height: 100%;
      fill: #fff; 
  }  

  .call-button {
      background-color: #FF2D2D;
  }

  .Line-button {
      background-color: #00C300;
  }

  .call-button:hover {
      background-color: #D32F2F; /* 深紅色 */
  }

  .Line-button:hover {
      background-color: #009B00; /* 深綠色 */
  }

  /* 定義動畫 */
  @keyframes shake_call {
      0% { transform: translateX(0) rotate(0deg); }
      12% { transform: translateX(-7px) rotate(-7deg); }
      24% { transform: translateX(7px) rotate(7deg); }
      36% { transform: translateX(-7px) rotate(-7deg); }
      100% { transform: translateX(0) rotate(0deg); }
  }


/*********************************************************************/

  /*  頁腳  */
  footer {
      color: #fff;
      display: flex;
      width: 100%;
      padding-top: 5px;
      justify-content: center; /* 確保子元素均勻分佈 */
      align-items: center;    /* 垂直居中對齊       */
      white-space: nowrap;    /* 不換行            */
      position: fixed;
      bottom: -10px; 
      z-index: 1; 
  }

/*********************************************************************/

  /*  螢幕大於768像素  */
  @media (min-width: 768px) {
      .uploadBox {
          min-width: 35vw;
          height: 27vh;
      }
      #mapShow {
          height: 48vh;
      }
  }

  /*  螢幕大於992像素  */
  @media (min-width: 992px) {
      #checkGpsOkBtn {
          transition: all 0.3s;
      }
      .uploadBox {
          min-width: 20vw;
          height: 30vh;
      }
      #mapShow {
          height: 53vh;
          margin-top: 25px;
      }
  }

  /*  螢幕大於1200像素  */
  @media (min-width: 1200px) {
      .uploadBox {
          min-width: 300px;
          height: 33vh;
      }
      #mapShow {
          height: 58vh;
          margin-top: 30px;
      }
      .formInput {
          margin-top: 45px;
      }
      .moveLabel {
          top: 60px;
    }

    .formInput:focus + .moveLabel,
    .formInput:not(:placeholder-shown) + .moveLabel {
        top: 22px;
        font-size: 0.9em;
    }

    #myGpsBtn, #goGpsBtn {
        margin: 45px 12px 0 0;
    }

    #delGoGpsInputBtn {
      top: 73%;
      right: 1px; 
      z-index: 0;
    }

  }


</style>
</head>
<body>

  <!--   SEO   -->
  <h1 class="Sr">GPS衛星定位, 屏東拖吊車, 屏東道路救援, 高雄拖吊車, 高雄道路救援, 24小時道路救援, 24h道路救援, 拖吊車, 汽車故障</h1>

<!----------------------------------------------------------------------------------------------------------------------------->

  <!--   頭部   -->
  <nav class="navbar navbar-dark bg-gradient bg-dark"> 
      <div class="d-flex align-items-center">
        <a href="#" class="logo">
          <img src="https://lh3.googleusercontent.com/pw/AP1GczMoHMqFF6inZpKPBCWCJB1yV3HS8PTjICLBYJZ950fo9i36syVEkS7wI6oIuzX_L2d1kOkmyNUc52gdYmBDNVBsieTLmrU23atOStR1JKDelVdK6P390CSqjv2JNRJndiol_8HqOZEpuVkO49iWBM4n=w720-h720-s-no-gm?authuser=0" alt="高雄屏東拖吊車提供的24小時道路救援服務">
        </a>
        <a class="noto-serif-hk-logo" href="https://leotowtruck.github.io/Yuhong.github.io/">拾捌拖吊車</a>
      </div>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="https://leotowtruck.github.io/Yuhong.github.io/#about-us">關於我們</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://leotowtruck.github.io/Yuhong.github.io/#services">服務項目</a>
          </li>          
          <li class="nav-item">
            <a class="nav-link" href="https://leotowtruck.github.io/Yuhong.github.io/#cases">救援案例</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://leotowtruck.github.io/Yuhong.github.io/#operations">吊掛作業</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://leotowtruck.github.io/Yuhong.github.io/#reviews">客戶評價</a>
          </li>
        </ul>
      </div>
  </nav>

<!----------------------------------------------------------------------------------------------------------------------------->

  <!-- icons.svg -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="icon-line" viewBox="0 0 16 16">
      <path d="M8 0c4.411 0 8 2.912 8 6.492 0 1.433-.555 2.723-1.715 3.994-1.678 1.932-5.431 4.285-6.285 4.645-.83.35-.734-.197-.696-.413l.003-.018.114-.685c.027-.204.055-.521-.026-.723-.09-.223-.444-.339-.704-.395C2.846 12.39 0 9.701 0 6.492 0 2.912 3.59 0 8 0M5.022 7.686H3.497V4.918a.156.156 0 0 0-.155-.156H2.78a.156.156 0 0 0-.156.156v3.486c0 .041.017.08.044.107v.001l.002.002.002.002a.15.15 0 0 0 .108.043h2.242c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157m.791-2.924a.156.156 0 0 0-.156.156v3.486c0 .086.07.155.156.155h.562c.086 0 .155-.07.155-.155V4.918a.156.156 0 0 0-.155-.156zm3.863 0a.156.156 0 0 0-.156.156v2.07L7.923 4.832l-.013-.015v-.001l-.01-.01-.003-.003-.011-.009h-.001L7.88 4.79l-.003-.002-.005-.003-.008-.005h-.002l-.003-.002-.01-.004-.004-.002-.01-.003h-.002l-.003-.001-.009-.002h-.006l-.003-.001h-.004l-.002-.001h-.574a.156.156 0 0 0-.156.155v3.486c0 .086.07.155.156.155h.56c.087 0 .157-.07.157-.155v-2.07l1.6 2.16a.2.2 0 0 0 .039.038l.001.001.01.006.004.002.008.004.007.003.005.002.01.003h.003a.2.2 0 0 0 .04.006h.56c.087 0 .157-.07.157-.155V4.918a.156.156 0 0 0-.156-.156zm3.815.717v-.56a.156.156 0 0 0-.155-.157h-2.242a.16.16 0 0 0-.108.044h-.001l-.001.002-.002.003a.16.16 0 0 0-.044.107v3.486c0 .041.017.08.044.107l.002.003.002.002a.16.16 0 0 0 .108.043h2.242c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157H11.81v-.589h1.525c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157H11.81v-.589h1.525c.086 0 .155-.07.155-.156Z"/>
    </symbol>

    <symbol id="icon-phone" viewBox="0 0 16 16">
      <path d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z"/>
    </symbol>
  </svg>

<!----------------------------------------------------------------------------------------------------------------------------->

  <div id="photoPage" class="container-fluid">
      <div class="formBlock">
          <h2>GPS定位派車</h2>
          <div class="row" id="gridContainer"></div>
          <div class="row">
              <div class="col-12">
                  <button id="PhotoNext" class="formButton" disabled>下一步</button>
              </div>
          </div>
      </div>
  </div>


  <div id="mapPage" class="container-fluid" style="display: none;">
      <div class="formBlock">
          <div class="input-container">
            <h2>GPS定位派車</h2>     
            <button id="mapPrevious" class="material-symbols-outlined" title="上一頁">arrow_back</button>
          </div>
          <div class="row">
              <div class="col">
                  <div class="input-container">
                      <input class="formInput" type="text" id="myGps" placeholder="" readonly>
                      <label for="myGps" class="moveLabel">您的車輛救援位置*</label>
                      <input id="myGpsHidden" type="hidden" value="-1">
                  </div>
              </div>
              <button id="myGpsBtn">
                  <img src="https://lh3.googleusercontent.com/pw/AP1GczMJ3-R91LpMseVbTlDr3z0UP2YCpEVyDueZf7RROSZqrW9DXe_b2QoQPDtwzZoNAQVkFtCdB4WXeivJOkYzFeKgbnh_EoHCtkBNN20LpweGo6a2BHITVmexRex9ADqyQdwt6OmNd9hYzG2NFxOkT_oc=w512-h512-s-no-gm?authuser=0" alt="my GPS Icon" title="地圖定位">
              </button>
          </div>
          <div class="row">
              <div class="col">
                  <div class="input-container">
                      <input class="formInput" type="text" id="goGps" placeholder="" readonly>
                      <label for="goGps" class="moveLabel">想去的維修廠 (依情況, 可不填)</label>
                      <button id="delGoGpsInputBtn" class="material-symbols-outlined" title="清除" style="display: none;">close</button>
                      <input id="goGpsHidden" type="hidden" value="-1">
                  </div>
              </div>
              <button id="goGpsBtn">
                  <img src="https://lh3.googleusercontent.com/pw/AP1GczMqhcGedtTjCXJXT_GhtoxateyV_BRpDnOvpSbB0TU55ktyfyTh2_CDvRObTg4uEdZYgPBpI4PZmaRyzKkPwhhoVZG1R2MVzxK39ypkCfZXtbOOoQmnX4RXPc8Bsu0SEpjMW1ld7oPJDYcAxNRr6A4d=w512-h512-s-no-gm?authuser=0" alt="go GPS Icon" title="地圖定位">
              </button>
          </div>
          <div class="row">
              <div class="col-12">
                  <div id="mapShow"></div>
              </div>
              <div class="col-12 col-md-4">
                  <div class="input-container">
                      <input class="formInput" type="text" id="gpsCar" value="大貨車模式" placeholder="" readonly>
                      <label for="gpsCar" class="moveLabel">導航路線*</label>
                  </div>
              </div>
              <div class="col-6 col-md-4">
                  <div class="input-container">
                      <input class="formInput" type="text" id="gpsDistance" placeholder="" value="0公里" readonly>
                      <label for="gpsDistance" class="moveLabel">計算距離* (自動)</label>
                  </div>
              </div>     
              <div class="col-6 col-md-4">
                  <div class="input-container">
                      <input class="formInput" type="text" id="gpstime" placeholder="" value="0分鐘" readonly>
                      <label for="gpstime" class="moveLabel">預計* (起拖到維修廠)</label>
                  </div>
              </div>
              <div class="col-12">
                  <button id="mapNext" class="formButton" disabled>下一步</button>
              </div>
          </div>
      </div>
  </div>

  <div id="submitPage" class="container-fluid" style="display: none;">
      <div class="formBlock">
          <div class="input-container">
              <h2>GPS定位派車</h2>
              <button id="submitPrevious" class="material-symbols-outlined" title="上一頁">arrow_back</button>
          </div>
          <div class="row">
              <div class="col-12">
                  <div class="input-container">
                      <input class="formInput" type="text" id="customerName" placeholder="" autocomplete="new-password">
                      <label for="customerName" class="moveLabel">您的稱呼*</label>
                      <div id="customerNameError" class="error"></div>
                  </div>
              </div>
              <div class="col-6">
                  <div class="input-container">
                      <input class="formInput" id="phone" placeholder="" inputmode="numeric" pattern="\d{10}" title="請輸入 10 位數字" autocomplete="new-password" oninput="validatePhoneInput(this)">
                      <label for="phone" class="moveLabel">連絡電話*</label>
                      <div id="phoneError" class="error"></div>
                  </div>
              </div>

              <div class="col-6">
                  <div class="input-container">
                      <input class="formInput" type="text" id="licensePlate" placeholder="" autocomplete="new-password" oninput="this.value = this.value.toUpperCase();">
                      <label for="licensePlate" class="moveLabel">車牌*</label>
                      <div id="licensePlateError" class="error"></div>
                  </div>
              </div>

              <div class="col-12">
                  <div class="input-container">
                      <input class="formInput" type="text" id="carModel" placeholder="" autocomplete="new-password">
                      <label for="carModel" class="moveLabel">車型* (一般轎車、休旅車、紅牌重機、35頓砂石車)</label>
                      <div id="carModelError" class="error"></div>
                  </div>
              </div>
              <div class="col-12">
                  <div class="input-container">
                      <input class="formInput" type="text" id="reason" placeholder="" autocomplete="new-password">
                      <label for="reason" class="moveLabel">拖吊原因* (例如: 後輪爆胎、汽車故障、車輛陷入困境)</label>
                      <div id="reasonError" class="error"></div>
                  </div>
              </div>

              <div class="col-12">
                  <div class="input-container">
                      <textarea class="formInput" id="remark" placeholder="" rows="4"></textarea>
                      <label for="remark" class="moveLabel">其他備註 (例如: 國一北上362K路肩 26頓大貨車 滿載)</label>
                  </div>
              </div>

              <div class="col-12">
                  <button id="submitBtn" class="formButton">送出資料</button>
              </div>
          </div>
      </div>
        <div class="fixed-buttons-container">
        <button class="call-button" onclick="makeCall()" aria-label="撥打電話">
          <svg class="icon"><use xlink:href="#icon-phone"></use></svg>
        </button>

        <button class="Line-button" onclick="openLine()" aria-label="加Line好友">
          <svg class="icon"><use xlink:href="#icon-line"></use></svg>
        </button>
      </div>
  </div>


  <!--  地圖浮動  -->
  <div class="map-content">
      <div id="map"></div>
          <!-- 包裹搜尋框和按鈕的容器 -->
          <div class="search-container">
              <input id="searchInput" type="text" placeholder="在這裡搜尋">
              <button id="delSearchTxtBtn" class="material-symbols-outlined" title="清除">close</button>
              <button id="searchBtn" class="material-symbols-outlined" title="搜尋">search</button>
          </div>
          <input id="showMapXY" readonly></input>
          <button id="shareLocation" class="material-symbols-outlined" title="重新定位">my_location</button>
          <button id="checkGpsOkBtn">確定位置</button>
      </div>
  </div>

  <!----------------------------------------------------------------------------------------------------------------------------->

  <!-- 警告視窗 -->
  <div id="alertBox" class="alert-box">
      <div class="alert-content">
          <p id="alertMessage"></p>
          <button id="confirmButton">確定</button>
      </div>
  </div>

  <!-- 加載效果的容器 -->
  <div class="containerLoader">
    <div class="central">
      <div class="loader" id="leader"></div>
    </div>
  </div>  

  <!-- 頁腳 -->
  <footer class="bg-gradient bg-dark">
      <p>&copy; 2024  拾捌拖吊車 服務公司版權所有.</p>
  </footer>


<!----------------------------------------------------------------------------------------------------------------------------->

<!-- 引入 Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>

  startLoading();


  const navbarCollapse = document.querySelector('.navbar-collapse'); // 獲取折疊菜單元素
  const bootstrapCollapse = new bootstrap.Collapse(navbarCollapse, { toggle: false }); // 創建 Bootstrap 折疊實例，不自動切換
  
  // 當點擊事件發生時隱藏下拉式選單
  document.addEventListener('click', (event) => {
      bootstrapCollapse.hide(); // 使用 Bootstrap 折疊 API 隱藏菜單
  });

// ========================================================================================================

  function createUploadBox() {
      // 創建外層 div 和設置類名
      const colDiv = document.createElement('div');
      colDiv.className = 'col';

      // 創建內層 uploadBox div 和設置類名
      const uploadBox = document.createElement('div');
      uploadBox.className = 'uploadBox';

      // 創建 file input 元素
      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = 'image/*';

      // 創建 label 元素
      const label = document.createElement('label');
      label.textContent = '上傳圖片';

      // 創建 delete button 元素
      const delPhotoBtn = document.createElement('button');
      delPhotoBtn.className = 'delPhotoBtn material-symbols-outlined';
      delPhotoBtn.title = '清除';
      delPhotoBtn.textContent = 'close';

      // 創建 image 元素
      const image = document.createElement('img');

      // 將 file input、label、delete button 和 image 添加到 uploadBox 中
      uploadBox.appendChild(fileInput);
      uploadBox.appendChild(label);
      uploadBox.appendChild(image);
      uploadBox.appendChild(delPhotoBtn);

      // 將 uploadBox 添加到 colDiv 中
      colDiv.appendChild(uploadBox);

      // 設置 file input 的 change 事件
      fileInput.addEventListener('change', function(event) {
          const file = event.target.files[0];
          if (file) {
              const reader = new FileReader();
              reader.onload = function(e) {
                  const imageUrl = e.target.result;
                  let isDuplicate = false; // 初始化 isDuplicate 變數

                  // 遍歷所有圖片格子，檢查是否有重複的圖片
                  const allImages = document.querySelectorAll('.uploadBox img');
                  for (let img of allImages) {
                      if (img.src === imageUrl) {
                          isDuplicate = true;
                          break; // 找到重複的圖片，退出循環
                      }
                  }

                  if (isDuplicate) {
                      alertMsg('這張圖片已經上傳過了！');
                      return; // 退出，不上傳重複圖片
                  }
                  
                  image.src = imageUrl;            // 設置 image 元素的 src 屬性
                  uploadBox.removeChild(label);    // 移除 label 元素
                  image.style.display = 'block';   // 顯示圖片

                  if (countUploadedImages() >= 2 ) {
                      document.getElementById('PhotoNext').disabled = false; // 啟用按鈕
                  }
                  // 檢查當前剩餘的空格子數量
                  const container = document.getElementById('gridContainer');

                  // 檢查當前的 box 是否是 container 的最後一個子元素
                  if (countUploadedImages() === container.children.length) {
                      initializeGrid(); // 如果是最後一個 box，創建新的格子
                  }
              };
              reader.readAsDataURL(file); // 讀取文件並轉換為 Data URL
          }
      });

      

      // 設置 delete button 的 click 事件
      delPhotoBtn.addEventListener('click', function() {
          const container = document.getElementById('gridContainer');
          const isLastBox = colDiv === container.lastElementChild;

          colDiv.remove(); // 刪除整個格子，包括 uploadBox 和 fileInput 等
          
          if (countUploadedImages() < 2) {
              document.getElementById('PhotoNext').disabled = true; // 禁用按鈕 
          }
          
          // 檢查刪除的格子是否為最後一格或是沒有格子，若是，則創建一個新的格子
          if (isLastBox || container.children.length < 6) {
              initializeGrid(); // 創建新的格子
          }
      });

      return colDiv;
  }

  function countUploadedImages() {
      // 遍歷所有的 .uploadBox 元素
      const uploadBoxes = document.querySelectorAll('.uploadBox');
      let imageCount = 0;

      uploadBoxes.forEach(box => {
          // 找到每個 .uploadBox 元素中的 img 元素
          const images = box.querySelectorAll('img');
          // 遍歷每個 img 元素，檢查是否有有效的 src
          images.forEach(img => {
              if (img.src) {
                  imageCount += 1; // 有圖片則計數
              }
          });
      });
      return imageCount;
  }


  function initializeGrid() {
      const container = document.getElementById('gridContainer');
      // 檢查格子數量（不超過8個）
      if (container.children.length < 8) {
          const box = createUploadBox();
          container.appendChild(box);
      }
  }

// ========================================================================================================

  let map;            // 地圖
  let marker;         // 圖釘
  let myMarker;       // 圖釘
  let goMarker;       // 圖釘
  let geocoder;       // 地圖 
  let originalMarker; // 圖釘GPS最初的定位

  var firstLatitude = -1;
  var firstLongitude = -1;        

  const taiwanBounds = {
      north: 25.5651,
      south: 20.4531,
      east: 122.0271,
      west: 119.3058
  };

  startLoading(); 

  function initMap() {

      mapShow = new google.maps.Map(document.getElementById('mapShow'), {
          center: { lat: 22.65, lng: 120.4 },
          zoom: 10,
          gestureHandling: 'auto',   // 禁用所有手勢，包括雙指縮放
          zoomControl: false,        // 隱藏放大縮小控件
          streetViewControl: false,  // 隱藏街景控件（可選）
          mapTypeControl: false,     // 隱藏地圖類型控件（可選）
          fullscreenControl: false,  // 隱藏全螢幕控件（可選）
      });


      map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 22.700901, lng: 120.420723 },
          zoom: 10,
          gestureHandling: 'greedy', // 禁用所有手勢，包括雙指縮放
          zoomControl: false,        // 隱藏放大縮小控件
          streetViewControl: false,  // 隱藏街景控件（可選）
          mapTypeControl: false,     // 隱藏地圖類型控件（可選）
          fullscreenControl: false,  // 隱藏全螢幕控件（可選）
      });

      geocoder = new google.maps.Geocoder();

      // 創建 InfoWindow
      infoWindow = new google.maps.InfoWindow({
          content: '',
          disableAutoPan: true // 禁用自動平移以顯示 InfoWindow
      });
      
  }


// ========================================================================================================


  var showMapBounds = new google.maps.LatLngBounds();

  // 變更showMap的座標
  function updateMapShow(targetInput, x, y) {

      if (targetInput.id == "myGps") {

          if (myMarker) {
              myMarker.setMap(null);
          }

          myMarker = new google.maps.Marker({
              position: { lat: x, lng: y },
              map: mapShow,
              draggable: false,
              icon: {
                  url: 'https://lh3.googleusercontent.com/pw/AP1GczMJ3-R91LpMseVbTlDr3z0UP2YCpEVyDueZf7RROSZqrW9DXe_b2QoQPDtwzZoNAQVkFtCdB4WXeivJOkYzFeKgbnh_EoHCtkBNN20LpweGo6a2BHITVmexRex9ADqyQdwt6OmNd9hYzG2NFxOkT_oc=w512-h512-s-no-gm?authuser=0',
                  scaledSize: new google.maps.Size(50, 50) // 調整圖標大小
              },
          });
          showMapBounds.extend(new google.maps.LatLng(x, y));  // 修正位置
      } else if (targetInput.id == "goGps") {
        
          // 如果已有圖釘，先移除
          if (goMarker) {
              goMarker.setMap(null);
          }

          goMarker = new google.maps.Marker({
              position: { lat: x, lng: y },
              map: mapShow,
              draggable: false,
              icon: {
                  url: 'https://lh3.googleusercontent.com/pw/AP1GczMqhcGedtTjCXJXT_GhtoxateyV_BRpDnOvpSbB0TU55ktyfyTh2_CDvRObTg4uEdZYgPBpI4PZmaRyzKkPwhhoVZG1R2MVzxK39ypkCfZXtbOOoQmnX4RXPc8Bsu0SEpjMW1ld7oPJDYcAxNRr6A4d=w512-h512-s-no-gm?authuser=0',
                  scaledSize: new google.maps.Size(50, 50) // 調整圖標大小
              },
          });
          showMapBounds.extend(new google.maps.LatLng(x, y));  // 修正位置
      }
      
      mapShow.fitBounds(showMapBounds);  // 調整地圖的視野以適應所有標記

      // 設置最小縮放級別
      const MIN_ZOOM_LEVEL = 16;
      google.maps.event.addListenerOnce(mapShow, 'bounds_changed', () => {
          const bounds = mapShow.getBounds();
          if (bounds) {
              const zoom = mapShow.getZoom();
              if (zoom > MIN_ZOOM_LEVEL) {
                  mapShow.setZoom(MIN_ZOOM_LEVEL);
              }
          }
      });

      // 解析經緯度座標
      const [myGpsLat, myGpsLng] = myGpsHidden.value.split(',').map(Number);
      const [goGpsLat, goGpsLng] = goGpsHidden.value.split(',').map(Number);

      // 在這裡添加距離和路線計算
      if (myGpsHidden.value !== "-1" && goGpsHidden.value !== "-1") {
          calculateDistance(myGpsLat, myGpsLng, goGpsLat, goGpsLng);
          calculateRoute(myGpsLat, myGpsLng, goGpsLat, goGpsLng);
      }
  }


// ========================================================================================================

  // 設置 Google Maps API 計算距離 (每日2000次免費請求)
  function calculateDistance(startLat, startLng, endLat, endLng) {
      const service = new google.maps.DistanceMatrixService();
      service.getDistanceMatrix({
          origins: [{ lat: startLat, lng: startLng }],
          destinations: [{ lat: endLat, lng: endLng }],
          travelMode: google.maps.TravelMode.DRIVING,
          drivingOptions: {
              departureTime: new Date(),  // 現在的時間
              trafficModel: 'bestguess'   // 最佳猜測的交通模型
          }
      }, (response, status) => {
          if (status === google.maps.DistanceMatrixStatus.OK) {
              const result = response.rows[0].elements[0];
              if (result.status === 'OK') {
                  const distance = result.distance.text;  // 距離文字
                  const duration = result.duration.text;  // 預計時間
                  gpstime.value = duration;
                  gpsDistance.value = distance;
              } else {
                  gpstime.value = "錯誤: " + result.status;
                  gpsDistance.value = "錯誤: " + result.status;
              }
          } else {
                  gpstime.value = "錯誤: " + status;
                  gpsDistance.value = "錯誤: " + status;
          }
      });
  }

  var directionsRenderer = new google.maps.DirectionsRenderer({
      suppressMarkers: true  // 隱藏默認標記
  });

  // 使用 Directions API 來計算兩點之間的路線，並設置為卡車模式 (每日2000次免費請求)
  function calculateRoute(startLat, startLng, endLat, endLng) {
      const directionsService = new google.maps.DirectionsService();   

      directionsRenderer.setDirections({});  // 清除路線
      directionsRenderer.setMap(null); // 移除路線渲染器

      directionsService.route({
          origin: new google.maps.LatLng(startLat, startLng),
          destination: new google.maps.LatLng(endLat, endLng),
          travelMode: google.maps.TravelMode.DRIVING,
          unitSystem: google.maps.UnitSystem.METRIC,
          drivingOptions: {
              departureTime: new Date(),  // 現在的時間
              trafficModel: 'bestguess'   // 最佳猜測的交通模型
          },
          // 卡車模式設定
          region: 'TW'  // 設置為台灣
      }, (response, status) => {
          if (status === google.maps.DirectionsStatus.OK) {
              directionsRenderer.setMap(mapShow);  // 在地圖上顯示新的路線
              directionsRenderer.setDirections(response);
          } else {
              // console.error('方向錯誤: ', status);
              alertMsg('方向錯誤: ', status);
          }
      });
  }


// ========================================================================================================
   

    const gpstime = document.getElementById("gpstime");
    const submitBtn = document.getElementById("submitBtn");
    const searchInput = document.getElementById("searchInput");
    const myGpsHidden = document.getElementById("myGpsHidden");
    const goGpsHidden = document.getElementById("goGpsHidden");
    const gpsDistance = document.getElementById("gpsDistance");
    const checkGpsOkBtn = document.getElementById("checkGpsOkBtn");

    function disabledTrue() {
        checkGpsOkBtn.disabled = true; // 禁用提交按鈕
        document.documentElement.style.overflow = 'hidden'; // 隱藏 html 的滾動條
        document.querySelector('.map-content').classList.add('fullscreen');
    }

    function disabledFalse() {
        document.documentElement.style.overflow = ''; // 啟用 html 的滾動條
        document.querySelector('.map-content').classList.remove('fullscreen');
    }

    let targethidden ="";
    let targetInput ="";
    let updataMsg="";

    // GPS定位
    function myGpsFun(inputTxt, hiddenTxt, msg) {
        
        searchInput.value = '';  // 清空文字

        // 確定更新的文本框
        if (inputTxt !== "") {
            targetInput = document.getElementById(inputTxt);
            targethidden = document.getElementById(hiddenTxt);

            updataMsg = msg;
            targetInput.value="";
        }

        disabledTrue();

        // 重新調整地圖大小以適應新的容器大小
        setTimeout(() => {
            google.maps.event.trigger(map, 'resize');
        }, 500);
        
        if (navigator.geolocation) { // 檢查瀏覽器是否支持地理定位
            navigator.geolocation.getCurrentPosition(
                function(position) { // 成功回調函數
                    firstLatitude = position.coords.latitude; // 獲取緯度
                    firstLongitude = position.coords.longitude; // 獲取經度
                    const userLocation = { lat: firstLatitude, lng: firstLongitude }; // 用戶的位置
                    map.setCenter(userLocation);
                    map.setZoom(17); // 更新地圖中心並放大

                      // 如果已有圖釘，先移除
                    if (originalMarker) {
                        originalMarker.setMap(null);
                    }

                    // 添加不可拖曳的原始定位圖釘
                    originalMarker = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        draggable: false,
                        icon: {
                            url: 'https://lh3.googleusercontent.com/pw/AP1GczNxy9w7uusplFlXTOVqO7CtXvRhJ3LGaioZMza596eX3tq0PHxFT2VX4vNcTUl4KVeDin5X50ouPDoPAVgu0oEL1Ve313_8ifYlR9Yj-LG3W82BwfzCbfrWZJIgwGX8bjfItchBGA-iYNwxMteCX8MJ=w512-h512-s-no-gm?authuser=0',
                            scaledSize: new google.maps.Size(32, 32) // 調整圖標大小
                        },
                        title: '原始位置(不可拖曳)',
                        zIndex: 1 // 將原始圖釘設置為較低層級
                    });

                    // 如果已有圖釘，先移除
                    if (marker) {
                        marker.setMap(null);
                    }

                    // 添加新的圖釘，使用預設圖標並設置為可拖曳
                    marker = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        draggable: true,
                        title: '您的位置(按住可拖曳)',
                        zIndex: 2 // 將新圖釘設置為較高層級
                    });

                    var newLatLng = -1;

                    // 強制將 marker 定位在畫面正中央
                    function centerMarker() {
                        const projection = map.getProjection();
                        if (projection) {
                            const centerPoint = projection.fromLatLngToPoint(userLocation); 
                            const mapCenterPoint = projection.fromLatLngToPoint(map.getCenter());

                            const offsetX = centerPoint.x - mapCenterPoint.x;
                            const offsetY = centerPoint.y - mapCenterPoint.y;

                            newLatLng = projection.fromPointToLatLng(new google.maps.Point(
                                centerPoint.x - offsetX,
                                centerPoint.y - offsetY
                            ));

                            marker.setPosition(newLatLng);
                            document.getElementById('showMapXY').value = updataMsg + ": x=" + newLatLng.lat() + ", y=" + newLatLng.lng();
                        }
                    }

                    // 清除舊的 tilesloaded 事件處理程序
                    google.maps.event.clearListeners(map, 'tilesloaded');
                    map.addListener('tilesloaded', centerMarker);

                    // 監聽圖釘拖曳事件
                    marker.addListener('dragend', function(event) {
                        newLatLng = event.latLng;
                        document.getElementById('showMapXY').value = updataMsg + ": x=" + newLatLng.lat() + ", y=" + newLatLng.lng();
                    });
        
                    checkGpsOkBtn.removeEventListener('click', handleCheckMapOkClick);
                    checkGpsOkBtn.addEventListener('click', handleCheckMapOkClick);

                    // 確認地圖座標OK
                    function handleCheckMapOkClick() {
                        startLoading();
                        setTimeout(() => {

                            // 確保圖釘存在並獲取其座標
                            if (marker) {
                                const markerPosition = marker.getPosition();
                                newLatLng = new google.maps.LatLng(markerPosition.lat(), markerPosition.lng());
                            }

                            const x = newLatLng !== -1 ? newLatLng.lat() : firstLatitude;
                            const y = newLatLng !== -1 ? newLatLng.lng() : firstLongitude;
                            targethidden.value = x + "," + y;

                            geocoder.geocode({ location: { lat: x, lng: y } }, function(results, status) {
                                if (status === google.maps.GeocoderStatus.OK) {
                                    if (results[0]) {
                                        targetInput.value = results[0].formatted_address;  // 更新 InfoWindow 的內容
                                    } else {
                                        targetInput.value = ('未找到地址!');  // 更新 InfoWindow 的內容
                                    }
                                    targetInput.setSelectionRange(targetInput.value.length, targetInput.value.length); // 將光標設置在文本末尾
                                }
                            });
                            setTimeout(() => {
                                stopLoading();
                                updateMapShow(targetInput, x, y);
                            }, 100);  // 1000 毫秒 = 1 秒
                        }, 400);  // 1000 毫秒 = 1 秒
                        disabledFalse();
                    }

                    // 初始逆地理編碼
                    updateInfoWindow(marker, updataMsg + "! (按住可拖曳)");
                    document.getElementById('showMapXY').value = updataMsg + ": x=" + firstLatitude + ", y=" + firstLongitude;
                    checkGpsOkBtn.disabled = false; // 啟用提交按鈕
                },
                function(error) { // 錯誤回調函數
                    stopLoading();
                    alertMsg("請再試一次『重新定位』\n若無法定位(瀏覽器不支援)\n\n 1. 請點『 ︙ 』圖示 \n2. 使用其它瀏覽器開啟!"); // 顯示錯誤信息
                },
                {
                    enableHighAccuracy: true, // 啟用高精度定位
                    timeout: 5000, // 超時時間設置為 5 秒
                    maximumAge: 0 // 不使用緩存的定位數據
                }
            );
        } else {
            stopLoading();
            alertMsg("請再試一次『重新定位』\n若無法定位(瀏覽器不支援)\n\n 1. 請點『 ︙ 』圖示 \n2. 使用其它瀏覽器開啟!"); // 瀏覽器不支持地理定位時顯示的消息
        }
    }


// ========================================================================================================

  // 更新並顯示 InfoWindow 的函數
  function updateInfoWindow(marker, msg) {
      infoWindow.close(); // 關閉 InfoWindow
      infoWindow.setContent(msg); // 更新 InfoWindow 的內容
      infoWindow.open(map, marker);  // 重新打開 InfoWindow 以顯示更新的內容
  }

  window.onload = function() {

      initMap();
      stopLoading();

      document.getElementById('myGpsBtn').addEventListener('click', function() {
          myGpsFun("myGps", "myGpsHidden", "您的車輛救援位置");
          document.getElementById('mapNext').disabled = false; // 啟用按鈕
      });

      document.getElementById('goGpsBtn').addEventListener('click', function() {
          myGpsFun("goGps", "goGpsHidden", "您想去的維修廠位置");
          document.getElementById('delGoGpsInputBtn').style.display = ''; // 隱藏按鈕
      });

      document.getElementById("shareLocation").addEventListener('click', function() {
          myGpsFun("");
      });

      initializeGrid(); // 產生第一個上傳圖片格子
      initializeGrid(); // 產生第二個上傳圖片格子
      initializeGrid(); // 產生第三個上傳圖片格子
      initializeGrid(); // 產生第四個上傳圖片格子

      fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
          window.ip = data.ip;
      })
        .catch(error => {
          fetch('https://api64.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
              window.ip = data.ip;
          })
            .catch(error => {
              window.ip = -1;
          });
      });
      alertMsg("上傳兩張汽車和背景照片，能幫助我們更快速的找到您汽車！");
  }


// ========================================================================================================


  const goGps = document.getElementById('goGps');
  const searchBtn = document.getElementById('searchBtn');

  // 清空goGpsInput欄位的文字
  document.getElementById('delGoGpsInputBtn').addEventListener('click', function() {

      document.getElementById('delGoGpsInputBtn').style.display = 'none'; // 隱藏按鈕

      if (goGps.value !== "") {
          goGps.value="";
          goGpsHidden.value="-1";

          if (goMarker) {
              goMarker.setMap(null); // 移除 goMarker
              goMarker = null; // 設置 goMarker 為 null，以便以後可以重新添加
          }

          directionsRenderer.setMap(null); // 移除路線渲染器
          directionsRenderer.setDirections({});  // 清除路線

          let myGpsLat = 22.65;
          let myGpsLng = 120.4;
          let MIN_ZOOM_LEVEL = 10; // 設置最小縮放級別

          if (myGpsHidden.value !== "-1") {
              showMapBounds = new google.maps.LatLngBounds();  // 更新 showMapBounds 之前先初始化
              [myGpsLat, myGpsLng] = myGpsHidden.value.split(',').map(Number);  // 解析經緯度座標
              MIN_ZOOM_LEVEL = 15;
          }

          showMapBounds.extend(new google.maps.LatLng(myGpsLat, myGpsLng));  // 更新邊界

          // 重新調整地圖的視野以適應所有標記
          mapShow.fitBounds(showMapBounds);

          google.maps.event.addListenerOnce(mapShow, 'bounds_changed', () => {
              const bounds = mapShow.getBounds();
              if (bounds) {
                  const zoom = mapShow.getZoom();
                  if (zoom > MIN_ZOOM_LEVEL) {
                      mapShow.setZoom(MIN_ZOOM_LEVEL);
                  }
              }
          });
          // 重新初始化 showMapBounds 以清除之前的邊界設置
          showMapBounds = new google.maps.LatLngBounds();

          gpstime.value = "0分鐘";
          gpsDistance.value = "0公里";
      }
  });

  // 清空搜索欄位的文字
  document.getElementById('delSearchTxtBtn').addEventListener('click', function() {
      searchInput.value = '';  // 清空文字
      searchInput.focus();     // 將焦點設置到輸入框
  });

  // 當輸入框獲得焦點時隱藏按鈕
  searchInput.addEventListener('focus', () => {
      searchBtn.style.color = '#1A73E8'; // 當 input 獲得焦點時變藍色
      checkGpsOkBtn.classList.add('hidden');
  });

  // 當輸入框失去焦點時顯示按鈕
  searchInput.addEventListener('blur', () => {
      searchBtn.style.color = '#767A7F'; // 當 input 失去焦點時恢復顏色
      checkGpsOkBtn.classList.remove('hidden');
  });

  // 判斷是否在搜索欄位輸入Enter  
  searchInput.addEventListener('keydown', function(event) {
      // 使用者按下 Enter 鍵時執行的程式碼
      if (event.key === 'Enter' || event.keyCode === 13) {
          geocodeAddress();
      }
  });

  searchBtn.addEventListener('click', geocodeAddress);

  // 搜尋地址
  function geocodeAddress() {

      // 檢查輸入是否不為空
      if (searchInput.value.trim() < 1) {
          searchInput.focus();     // 將焦點設置到輸入框
          return;
      }

      const address = searchInput.value;

      if (address) {
          geocoder.geocode({ 
              address: address,
              bounds: taiwanBounds // 限制搜尋範圍在台灣
          }, function(results, status) {
              if (status === google.maps.GeocoderStatus.OK) {
                  if (results[0]) {
                      const location = results[0].geometry.location;

                      // 清除之前的標記
                      if (marker) {
                          marker.setMap(null);
                      }

                      // 在地圖上顯示目標位置
                      map.setCenter(location);
                      map.setZoom(19);

                      marker = new google.maps.Marker({
                          map: map,
                          position: location,
                          title: results[0].formatted_address,
                          draggable: true // 確保圖釘是可拖曳的
                      });
                      searchInput.blur(); // 取消焦點
                  } else {
                      searchPlacesAddress(address);  // Geocoder 搜尋失敗，使用 Places API 進行備用搜尋
                  }
              } else {
                    searchPlacesAddress(address);  // Geocoder 搜尋失敗，使用 Places API 進行備用搜尋
              }
          });
      } 
  }

  // 備用搜尋
  function searchPlacesAddress(address) {

      // 使用 Places API 進行地點搜尋
      const service = new google.maps.places.PlacesService(map);
      const currentCenter = map.getCenter(); // 獲取地圖的中心點

      // 根據當前地圖中心點設定搜尋範圍
      const searchBounds = new google.maps.LatLngBounds(
          new google.maps.LatLng(currentCenter.lat() - 0.3, currentCenter.lng() - 0.3),
          new google.maps.LatLng(currentCenter.lat() + 0.3, currentCenter.lng() + 0.3)
      );
      
      // 使用 textSearch 方法進行搜尋
      service.textSearch({ 
            query: address, // 搜尋的地址或關鍵字
            bounds: searchBounds // 設置搜尋範圍
       }, function(results, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
              if (results[0]) {
                  const location = results[0].geometry.location;

                  // 清除之前的標記
                  if (marker) {
                      marker.setMap(null);
                  }

                  // 在地圖上顯示目標位置
                  map.setCenter(location);
                  map.setZoom(19);

                  marker = new google.maps.Marker({
                      map: map,
                      position: location,
                      title: results[0].formatted_address,
                      draggable: true // 確保圖釘是可拖曳的
                  });
                  searchInput.blur(); // 取消焦點
              } else {
                  alertMsg('未找到該地址!');
              }
          } else {
              alertMsg('未找到該地址!' + status);
          }
      });
  }

// ========================================================================================================

  function validatePhoneInput(input) {
      // 只允許數字
      input.value = input.value.replace(/\D/g, '');
      // 限制最多輸入 10 個數字
      if (input.value.length > 10) {
          input.value = input.value.slice(0, 10);
      }
  }

// ========================================================================================================



  // 送出資料
  submitBtn.addEventListener('click', function() {

      // 獲取表單中的輸入值
      const myGps = document.getElementById('myGps').value.trim();                // 救援的定位
      const phone = document.getElementById('phone').value.trim();                // 電話
      const remark = document.getElementById('remark').value.trim();              // 備註
      const reason = document.getElementById('reason').value.trim();              // 原因
      const carModel = document.getElementById('carModel').value.trim();          // 車型
      const customerName = document.getElementById('customerName').value.trim();  // 稱呼
      const licensePlate = document.getElementById('licensePlate').value.trim();  // 車牌

      const phoneError = document.getElementById('phoneError');
      const reasonError = document.getElementById('reasonError');
      const carModelError = document.getElementById('carModelError');
      const customerNameError = document.getElementById('customerNameError');
      const licensePlateError = document.getElementById('licensePlateError');

      // 將每個錯誤顯示元素的對應輸入欄位
      const phoneInput = document.getElementById('phone');
      const reasonInput = document.getElementById('reason');
      const carModelInput = document.getElementById('carModel');
      const customerNameInput = document.getElementById('customerName');
      const licensePlateInput = document.getElementById('licensePlate');

      phoneError.textContent = "";
      reasonError.textContent = "";
      carModelError.textContent = "";
      customerNameError.textContent = "";
      licensePlateError.textContent = "";

      let isValid = true;
      let firstErrorElement = null;

      // 驗證稱呼
      if (!customerName) {
          isValid = false;
          customerNameError.textContent = '稱呼不得為空*';
          if (!firstErrorElement) {
              firstErrorElement = customerNameInput;
          }
      }

      // 驗證電話
      if (!phone.match(/^\d{10}$/)) {
          isValid = false;
          phoneError.textContent = '手機號碼必須是 10 位數字*';
          if (!firstErrorElement) {
              firstErrorElement = phoneInput;
          }
      }

      // 驗證拖吊原因
      if (!reason) {
          isValid = false;
          reasonError.textContent = '拖吊原因不得為空*';
          if (!firstErrorElement) {
            firstErrorElement = reasonInput;
          }
      }

      // 驗證車型
      if (!carModel) {
          isValid = false;
          carModelError.textContent = '車型不得為空*';
          if (!firstErrorElement) {
              firstErrorElement = carModelInput;
          }
      }

      // 驗證車牌
      if (!licensePlate) {
          isValid = false;
          licensePlateError.textContent = '車牌不得為空*';
          if (!firstErrorElement) {
              firstErrorElement = licensePlateInput;
          }
      }

      // 設置焦點到第一個錯誤的欄位
      if (!isValid && firstErrorElement) {
          firstErrorElement.focus(); // 設置焦點
          firstErrorElement.scrollIntoView({ behavior: 'smooth', block: 'center' }); // 滾動到視口中
      }

      if(!window.isUploadImg) {
          alertMsg("圖片上傳失敗, 請重新再試一次圖片功能!");
          return;
      }

      if (window.isUploadImg && isValid) {
          startLoading();
          submitBtn.disabled = true; // 禁用提交按鈕

          var formData = new FormData();

          // 添加其他資料到 formData
          formData.append('ip', window.ip);
          formData.append('phone', phone);                                     // 電話號碼
          formData.append('remark', remark);                                   // 備註
          formData.append('reason', reason);                                   // 拖吊原因
          formData.append('carModel', carModel);                               // 車型
          formData.append('customerName', customerName);                       // 稱呼
          formData.append('gpstime', gpstime.value);                           // 預估時間
          formData.append('myChineseGPS', myGps);                              // 救援的定位(拖曳)[中文]
          formData.append('goChineseGPS', goGps.value);                        // 維修廠的定位[中文]
          formData.append('myGPS', myGpsHidden.value);                         // 拖車的定位(拖曳)
          formData.append('goGPS', goGpsHidden.value);                         // 維修廠的定位
          formData.append('licensePlate', licensePlate);                       // 車牌
          formData.append('gpsDistance', gpsDistance.value);                   // 計算距離
          formData.append('firstGPS', (firstLatitude + "," + firstLongitude)); // 最初的定位(GPS)

          // 將 window.myArray 的數據添加到 FormData 中
          window.array.forEach((item, index) => {
            // 轉換為 JSON 字串
             formData.append(item.key + index , item.value);
             // alert(item.key + index + " / " + item.value);
          });

         fetch('https://script.google.com/macros/s/AKfycbz2IRj6Wf2o9m9bBsz2UbkovOKd7CikTHL9b6Ed0RyTKdM89FgxxX_fWkZEa69EqT-H/exec', {
              method: 'POST', // 設置請求方法為 POST
              body: formData // 直接使用 FormData 對象
          })
          .then(response => response.text())
          .then(result => {
              alertMsg(result); // 提交成功後顯示成功提示
          })
          .catch(error => {
              alertMsg(" 您的瀏覽器不支援! \n\n 1. 請點『 ︙ 』圖示 \n2. 使用其它瀏覽器開啟!" + error);
          })
          .finally(() => {
              stopLoading();
              submitBtn.disabled = false;      // 啟用提交按鈕
          });
      }
  });

// ========================================================================================================

    // 顯示警告內容
    function alertMsg(msg) {
        const alertBox = document.getElementById('alertBox');
        const alertMessage = document.getElementById('alertMessage');
        alertMessage.textContent = msg;
        alertBox.classList.add('show');
    }

    // 隱藏警告視窗
    document.getElementById('confirmButton').addEventListener('click', function () {
        alertBox.classList.remove('show');
    });


// ========================================================================================================


  function startLoading() {
      const containerloader = document.querySelector('.containerLoader');
      const loader = document.querySelector('.loader');
      loader.style.animationPlayState = 'running';       // 啟動動畫旋轉
      loader.style.display = 'block';                    // 顯示 loader
      containerloader.style.display = 'block';           // 顯示容器
  }

  function stopLoading() {
    const containerloader = document.querySelector('.containerLoader');
    const loader = document.querySelector('.loader');
    loader.style.animationPlayState = 'paused';       // 暫停動畫旋轉
    loader.style.display = 'none';                    // 隱藏loader
    containerloader.style.display = 'none';           // 隱藏容器
  }


// ========================================================================================================


  var formData = new FormData();
  const mapPage = document.getElementById('mapPage'); 
  const photoPage = document.getElementById('photoPage');

  document.getElementById('mapPrevious').addEventListener('click', function () {
      mapPage.style.display = 'none';     // 隱藏      
      photoPage.style.display = 'block';  // 顯示
      window.scrollTo(0, 0);  // 滾動到網頁的頂部
  });

  document.getElementById('mapNext').addEventListener('click', function () {
      mapPage.style.display = 'none';     // 隱藏     
      submitPage.style.display = 'block'; // 顯示
      window.scrollTo(0, 0);  // 滾動到網頁的頂部
  });

  document.getElementById('submitPrevious').addEventListener('click', function () {
      submitPage.style.display = 'none';   // 隱藏     
      mapPage.style.display = 'block';     // 顯示
      window.scrollTo(0, 0);  // 滾動到網頁的頂部
  });


// ========================================================================================================

</script>


<!-- 加載 Firebase SDK -->
<script type="module">

  // 從 Firebase SDK 中導入所需的模組
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";

  // Firebase 配置對象，包含應用的 API 金鑰和其他識別信息
  const firebaseConfig = {
    apiKey: "AIzaSyD7VW3vOlGQUCzf4wJy24BtRR-tLxTnT7I",
    authDomain: "towing-d99da.firebaseapp.com",
    projectId: "towing-d99da",
    storageBucket: "towing-d99da.appspot.com",
    messagingSenderId: "977746503781",
    appId: "1:977746503781:web:3d7acb3d08c8e71c13fe8c"
  };

  // 初始化 Firebase 應用
  const app = initializeApp(firebaseConfig);

  // 獲取 Firebase Storage 服務的引用
  const storage = getStorage(app);



  async function compressAndConvertToBase64() {

      var i = 0;
      window.isUploadImg = false;
      window.array = [];
      const fileInputs = document.querySelectorAll('.uploadBox input[type="file"]');

      const filePromises = Array.from(fileInputs).map(async (input) => {
          if (input.files[0]) {
              const file = input.files[0];
              const blob = await new Promise((resolve, reject) => {
                  const reader = new FileReader();
                  reader.onloadend = () => {
                    const img = new Image();
                    img.onload = () => {
                      const canvas = document.createElement('canvas');
                      const ctx = canvas.getContext('2d');
                      const maxWidth = 800;
                      const maxHeight = 600;
                      let width = img.width;
                      let height = img.height;

                      if (width > height) {
                        if (width > maxWidth) {
                          height *= maxWidth / width;
                          width = maxWidth;
                        }
                      } else {
                        if (height > maxHeight) {
                          width *= maxHeight / height;
                          height = maxHeight;
                        }
                      }

                      canvas.width = width;
                      canvas.height = height;
                      ctx.drawImage(img, 0, 0, width, height);
                      canvas.toBlob(resolve, 'image/jpeg', 0.9); // 壓縮質量
                    };
                    img.src = reader.result;
                  };
                  reader.onerror = reject;
                  reader.readAsDataURL(file);
              });

              i = i + 1 ;

              // 生成當前日期時間字串
              const now = new Date();
              const year = now.getFullYear();
              const month = String(now.getMonth() + 1).padStart(2, '0'); // 月份從 0 開始，所以加 1
              const day = String(now.getDate()).padStart(2, '0');
              const hours = String(now.getHours()).padStart(2, '0');
              const minutes = String(now.getMinutes()).padStart(2, '0');
              const dateTimeString = year + month +"/" + day + " 日, 時間: " + hours + ":" + minutes;
              
              try {
                  const storageRef = ref(storage, dateTimeString + " - 第" + i + "張");
                  await uploadBytes(storageRef, blob, { contentType: 'image/jpeg' });
                  const url = await getDownloadURL(storageRef);
                  window.array.push({ key: ("imgUrl"), value: url });
              } catch (error) {
                  console.error("上傳圖片時出錯：", error);
              }
          }
      });

      try {
        await Promise.all(filePromises);
          window.isUploadImg = true;
      } catch (error) {
          console.error("上傳圖片時出錯：", error);
      }
  }

  document.getElementById('PhotoNext').addEventListener('click', function () {
      if (window.ip === -1) {
        alertMsg("您的瀏覽器不支援\n\n 1. 請點『 ︙ 』圖示 \n 2. 使用其它瀏覽器開啟!");
        return;
      }
      photoPage.style.display = 'none'; // 隱藏
      mapPage.style.display = 'block';  // 顯示
      compressAndConvertToBase64();
  });
  
  //========================================================================

  function makeCall() {
    window.location.href = "tel:0981263978";
  }

  function openLine() {
    window.open("https://line.me/ti/p/idtb0LETDp", "_blank");
  }

</script>

</body>
</html>
